# Ops file to enable Docker registry access on port 5000
# Docker registry will be colocated on Concourse instance

# Add docker-registry release
- type: replace
  path: /releases/-
  value:
    name: docker-registry
    version: 3.6.0
    url: https://bosh.io/d/github.com/cloudfoundry-community/docker-registry-boshrelease

# Add docker-registry job to Concourse instance
- type: replace
  path: /instance_groups/name=concourse/jobs/-
  value:
    name: docker-registry
    release: docker-registry
    properties:
      docker_registry:
        auth:
          username: admin
          password: ((docker_registry_password))
        http:
          addr: 0.0.0.0:5000
        storage:
          delete:
            enabled: true

# Generate password for docker registry
- type: replace
  path: /variables/-
  value:
    name: docker_registry_password
    type: password

# Open port 5000 for docker registry access
- type: replace
  path: /instance_groups/name=concourse/networks/0/default?/-
  value: gateway
