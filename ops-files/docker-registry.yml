# Ops file to enable Docker registry access on port 5000
# Docker registry will be colocated on Concourse instance

# Add docker-registry release
- type: replace
  path: /releases/-
  value:
    name: docker-registry
    version: 3.6.0
    url: https://bosh.io/d/github.com/cloudfoundry-community/docker-registry-boshrelease

# Add docker-registry job to Concourse instance
- type: replace
  path: /instance_groups/name=concourse/jobs/-
  value:
    name: registry
    release: docker-registry
    properties:
      docker:
        registry:
          bind: 0.0.0.0
          port: 5000
        proxy:
          username: admin
          password: ((docker_registry_password))
      nfs:
        server:
          allow_from_entries:
            - 127.0.0.1
        share: ~

# Generate password for docker registry
- type: replace
  path: /variables/-
  value:
    name: docker_registry_password
    type: password

# Open port 5000 for docker registry access
- type: replace
  path: /instance_groups/name=concourse/networks/0/default?/-
  value: gateway
